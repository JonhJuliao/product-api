name: CI on Pull Requests

on:
  pull_request:
    branches: ["main"]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout do repositório
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Trocar para a branch do PR (atividade frequente)
        run: |
          git fetch origin "${{ github.event.pull_request.head.ref }}" --depth=1
          git checkout "${{ github.event.pull_request.head.ref }}"

      - name: Instalar Java 17 (Temurin) + cache Maven
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
          cache: 'maven'

      - name: Baixar dependências (offline-ready)
        run: mvn -B -q -DskipTests dependency:go-offline

      - name: Compilar
        run: mvn -B -q -DskipTests package

      - name: Executar testes
        run: mvn -B test
